<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/static/assets/img/favicon.png">
    <link rel="stylesheet" href="/static/plugins/layui/css/layui.css">
    <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/plugins/animate/animate.min.css">
    <link rel="stylesheet" href="/static/assets/css/style.css">
    <link rel="stylesheet" href="/static/assets/css/layui-theme-nbv5.css">
    <link rel="stylesheet" href="/static/plugins/pushbar/pushbar.css">
    <link rel="stylesheet" href="/static/assets/css/simple.css">
    <title th:text="${nbv5su!=null?nbv5su.nickname:''}+'用户中心'"></title>
    <style>
        .layui-nav-tree .layui-this, .layui-nav-tree .layui-this > a {
            background-color: #f44336cc !important
        }

        .left-nav > ul {
            height: 600px !important;
            padding-top: 15px !important;
            width: 100% !important;
            background-color: #fff !important;
            box-shadow: 0 2px 5px 0 rgba(0, 0, 0, .1) !important
        }

        .right-nav div.layui-card {
            height: 600px !important
        }

        .layui-nav-tree .layui-nav-item a:hover {
            background-color: #fff !important
        }

        .layui-nav .layui-nav-item a:hover, .layui-nav .layui-nav-itemed a.layui-this {
            color: #f8f8f8 !important
        }

        .layui-nav .layui-nav-item a, .layui-nav .layui-this a {
            color: #000 !important
        }

        .layui-nav-tree .layui-nav-item a:hover {
            background-color: #f44336cc !important
        }
    </style>
</head>
<body class="layui-anim layui-anim-fadein simple">
<!--顶部导航栏-->
<div class="header mini">
    <div class="layui-container header-content">
        <div class="layui-row nav-header">
            <div class="layui-col-xs9 layui-col-sm4">
                <a class="logo" href="/index">
                    <i th:class="${settings.website_fontawesome}"></i>&nbsp;[[${settings.website_logo_words}]]</a>
                <small th:text="${settings.website_logo_small_words}"></small>
            </div>
            <div class="layui-col-xs3 layui-col-sm-offset2 layui-col-sm4 layui-hide-md layui-hide-lg nav-btn">
                <a href="javascript:nbv5front.hideOpen();" id="side-nav-open"
                   data-pushbar-target="bottomNav"><i class="fa fa-navicon"></i> </a>
                <a href="javascript:nbv5front.hideClose();" id="side-nav-close" style="display: none;"
                   data-pushbar-close><i class="fa fa-times" style="font-size: 18px;"></i> </a>
            </div>
            <div class="layui-col-sm5 layui-hide layui-show-lg-inline-block layui-show-md-inline-block nav-btn right">
                <a href="/index" th:data-title="${settings.menu_home}">
                    <i class="layui-icon layui-icon-home"></i>
                    <span th:text="${settings.menu_home}"></span>
                </a>
                <a href="/note" th:data-title="${settings.menu_note}">
                    <i class="layui-icon layui-icon-form"></i>
                    <span th:text="${settings.menu_note}"></span>
                </a>
                <a href="/message" th:data-title="${settings.menu_message}">
                    <i class="layui-icon layui-icon-chat"></i>
                    <span th:text="${settings.menu_message}"></span>
                </a>
                <a href="/login?redirectUrl=/ubs/token/index" class="active" data-title="用户">
                    <i class="layui-icon layui-icon-user"></i>
                    <span>用户</span>
                </a>
                <a href="javascript:nbv5front.searchDialog();" data-title="搜索">
                    <i class="layui-icon layui-icon-search"></i>
                    <span>搜索</span>
                </a>
            </div>
        </div>
    </div>
</div>
<hr class="header-hr">

<!--顶部文字-->
<div class="layui-container top-block">
    <blockquote class="layui-elem-quote">
        <span class="layui-breadcrumb">
            <a href="/">网站首页</a>
            <a href="/login?redirectUrl=/ubs/token/index">用户中心</a>
        </span>
        <div class="clock layui-show-md-inline-block layui-show-lg-inline-block layui-hide-xs layui-hide-sm">
            <span class="clock-font">当前日期</span>：<span id="current-datetime"></span>
        </div>
    </blockquote>
</div>

<!--内容文章正体-->
<div id="main-body" class="layui-container layui-mt20" style="margin-bottom: 30px;">
    <div class="layui-row layui-col-space20">
        <div class="layui-col-md2 layui-hide-sm layui-hide-xs layui-show-md-inline-block left-nav">
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="/login?redirectUrl=/ubs/token/index" class="layui-this"><i class="fa fa-user-secret"></i>
                        用户中心</a>
                </li>
                <li class="layui-nav-item">
                    <a href="/ubs/token/message"><i class="fa fa-envelope"></i> 我的消息</a>
                </li>
                <li class="layui-nav-item">
                    <a href="/ubs/token/comment"><i class="fa fa-comment"></i> 我的评论</a>
                </li>
                <li class="layui-nav-item">
                    <a href="/ubs/token/purchase"><i class="fa fa-shopping-cart"></i> 我的购买</a>
                </li>
            </ul>

        </div>
        <div class="layui-col-md10 right-nav animated fadeInUp">
            <div class="layui-card">
                <div class="layui-card-body" style="padding: 30px;">
                    <blockquote class="layui-elem-quote"
                                th:text="'Hi!,'+${nbv5su.nickname}+'。'+${settings.ubs_top_notice}"></blockquote>
                    <hr class="layui-mt20">
                    <div class="layui-row layui-mt20">
                        <img th:src="${nbv5su.avatar}" id="avatar"
                             style="width: 60px;height: 60px;border: 1px solid #e0e0e0;cursor:pointer;"
                             class="layui-circle">
                        <label th:text="${nbv5su.nickname}" style="margin-left: 5px;"></label>
                        <label style="color: #F44336;" th:if="${nbv5su.role == 1}"><b>[管理员]</b></label>
                        <label th:if="${nbv5su.role == 2}"><b>[注册用户]</b></label>
                        <label th:if="${nbv5su.role == 3}"><b>[QQ用户]</b></label>
                        <label th:if="${nbv5su.role == 4}"><b>[Github用户]</b></label>
                        <a href="/token/logout" class="layui-btn layui-btn-primary layui-btn-sm"><i
                                class="fa fa-sign-out"></i> 退出</a>
                    </div>
                    <div class="layui-row layui-mt20">
                        <a th:if="${signed eq 0}" class="layui-btn-sm layui-btn layui-bg-black" id="sign">
                            <i class="fa fa-check"></i> 签到
                        </a>
                        <span th:if="${signed eq 1}" style="border: 1px solid #cccccc;padding: 5px 10px;"><i
                                class="fa fa-check"></i> 已签到</span>
                        <small class="layui-text layui-word-aux">每日一次，一次 [[${settings.sign_check_coin}]]
                            个</small>
                    </div>
                    <div class="layui-row layui-mt20">
                        <label style="font-size: 16px;margin-top: 15px;">你所持有的硬币个数为：<img
                                src="/static/assets/img/coin.png"
                                style="width: 15px;margin-top: -5px;">
                            <span style="color: #ff262e;" th:text="${nbv5su.remainCoin}"></span>
                            <div class="layui-btn-group" style="margin-left: 5px;">
                                <a class="layui-btn-sm layui-btn layui-hide-xs layui-show-sm-inline-block"
                                   id="cash-recharge" style="margin-left: 10px"><i
                                        class="fa fa-credit-card"></i> 卡号充值</a>
                                <a class="layui-btn-sm layui-btn layui-bg-blue" style="margin-left: 10px;"><i
                                        class="fa fa-paypal"></i>
                                    支付宝充值</a>
                            </div>
                        </label>
                    </div>
                    <hr class="layui-mt20">
                    <div class="layui-row layui-mt20">
                        <label for="nickname">
                            <input type="text" id="nickname" th:value="${nbv5su.nickname}" class="layui-input"
                                   style="max-width: 200px;display: inline-block;">
                        </label>
                        <button type="button" class="layui-btn layui-btn-primary" id="nickname-change">修改</button>
                    </div>
                    <hr class="layui-mt20">
                    <div class="layui-row layui-mt20" th:if="${nbv5su.role == 2}">
                        <p style="max-width: 200px;">
                            <input class="layui-input" type="password" name="password" placeholder="输入新密码（至少6位）"
                                   minlength="6">
                        </p>
                        <p style="max-width: 200px;margin-top: 20px;">
                            <input class="layui-input" type="text" name="mailCode" placeholder="输入邮箱中的验证码">
                        </p>
                        <p class="layui-mt20">
                            <button id="sendMailCode" class="layui-btn layui-btn-primary layui-btn-sm"
                                    type="button">
                                <span id="sendCode">点击发送</span><span id="sendSeconds"></span>
                            </button>
                            <button type="button" class="layui-btn  layui-btn-sm" id="pass-change">提交修改</button>
                        </p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!--底部导航栏-->
<div class="layui-fluid bottom-nav">
    <div class="layui-row bottom-logo">
        <div class="layui-col-md4 layui-col-md-offset4 text-center">
            <img th:src="${settings.bottom_logo}" alt="笔记博客">
        </div>
    </div>
    <hr style="background: rgba(230, 230, 230, 0.54);">
    <div class="layui-row layui-col-space30" style="padding-top: 20px;">
        <div class="layui-col-md4 copyright">
            <p style="text-align: center;">
                <i class="fa fa-copyright"></i>&nbsp;[[${settings.footer_words}]] powered by
                <a href="//wuwenbin.me" target="_blank" style="color: #1E9FFF;">NoteBlog</a> in 2019 v5.
            </p>
        </div>
        <div class="layui-col-md4 cates">
            <p>分类</p>
            <span class="layui-badge-rim no-select" th:each="cate :${cateList}"><a
                    th:href="${'/s/c?q='+cate.name}" th:text="${cate.name}"></a>
            </span>
        </div>
        <div class="layui-col-md4 manage">
            <p style="margin-bottom: 10px;">数据・用户</p>
            <p class="data">
                <span>[[${#numbers.formatDecimal(blogCount,1,'COMMA',0,'POINT')}]] <b>文章</b></span>
                <span>[[${#numbers.formatDecimal(commentCount,1,'COMMA',0,'POINT')}]] <b>评论</b></span>
                <span>[[${#numbers.formatDecimal(runningDays,1,'COMMA',0,'POINT')}]] <b>天</b></span>
                <span>[[${#numbers.formatDecimal(blogWords,1,'COMMA',0,'POINT')}]] <b>字数</b></span>
            </p>
            <p>
                <a th:if="${nbv5su ==null}" onclick="nbv5front.bottomLogin();"
                   class="layui-btn layui-btn-sm layui-btn-primary">登录</a>
                <span th:if="${nbv5su !=null}" class="layui-mr15">
                    <img th:src="${nbv5su.avatar}" class="layui-circle" style="width: 30px;"/>
                    <a th:text="${nbv5su.nickname}" class="layui-text layui-word-aux"
                       href="/login?redirectUrl=/ubs/token/index"></a>
                </span> <a onclick="nbv5front.tokenLogout();" class="layui-btn layui-btn-sm layui-btn-primary">退出</a>
            </p>
        </div>
    </div>
</div>

<!--移动设备菜单导航-->
<div data-pushbar-id="bottomNav" class="pushbar from_bottom">
    <div class="layui-container" style="padding-top: 20px;padding-bottom: 15px;">
        <fieldset class="layui-elem-field layui-field-title">
            <legend style="text-align: center;font-size: 16px;">导航按钮</legend>
        </fieldset>
        <p class="layui-breadcrumb" lay-separator="|" style="text-align: center;margin-top: 10px;">
            <a href="/index" th:text="${settings.menu_home}"></a>
            <a href="/note" th:text="${settings.menu_note}"></a>
            <a href="/message" th:text="${settings.menu_message}"></a>
            <a href="/login?redirectUrl=/ubs/token/index">用户</a>
            <a href="/s/w">搜索</a>
        </p>
        <ul class="layui-timeline"
            style="margin-top: 10px;padding-top: 15px;margin-bottom: 30px;border-top: 1px dotted #EEEEEE;">
            <li class="layui-timeline-item">
                <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                <div class="layui-timeline-content layui-text">
                    <h3 class="layui-timeline-title" style="font-size: 16px;">博客信息</h3>
                    <p style="padding-bottom: 5px;" th:utext="${settings.info_label_text}"></p>
                    <p style="border-top: 1px solid #f5f5f5;padding-top: 5px;padding-bottom: 5px;">
                        交流讨论：<i class="fa fa-qq"></i>
                        <a target="_blank"
                           href="//shang.qq.com/wpa/qunwpa?idkey=7bd7c01acf4e6124bfaab5a6d10504b917d5292f029b66887d00006a16a00930">
                            697053454
                        </a>。
                    </p>
                    <p style="border-top:1px solid #F5F5F5;padding-top: 5px;">
                        项目源码：<i class="fa fa-github-alt"></i>
                        <a target="_blank" href="https://github.com/miyakowork/noteblogv5">miyakowork/noteblogv5</a>。
                    </p>
                </div>
            </li>
            <li class="layui-timeline-item">
                <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                <div class="layui-timeline-content layui-text">
                    <h3 class="layui-timeline-title" style="font-size: 16px;">作者 </h3>
                    <p>联系作者：<i class="fa fa-envelope"></i> <a href="#">wuwenbinwork#163.com</a></p>
                    <p>作者网站：<i class="fa fa-link"></i> <a href="https://wuwenbin.me">https://wuwenbin.me</a></p>
                </div>
            </li>
        </ul>
    </div>
</div>

<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script src="/static/plugins/layui/layui.js"></script>
<script src="/static/assets/js/svg.js"></script>
<script src="/static/plugins/jquery/jquery-2.1.4.min.js"></script>
<script src="/static/assets/js/script.js"></script>
<script src="/static/assets/js/nbv5.js"></script>
<script src="/static/plugins/md5/md5.min.js"></script>
<script src="/static/plugins/hc-sticky/hc-sticky.min.js"></script>
<script src="/static/plugins/pushbar/pushbar.js"></script>
<script th:inline="javascript">
    $(function () {
        window.addEventListener("scroll", nbv5front.headerScroll());
        nbv5front.miniHeader("main-body");
        new Pushbar({
            blur: true,
            overlay: true
        });


        layui.use(['layer', 'element', 'upload'], function () {
            var layer = layui.layer,
                element = layui.element,
                upload = layui.upload;
            element.render();

            nbv5front.miniHeaderNavBtn(layer);

            upload.render({
                elem: '#avatar' //绑定元素
                , url: '/ubs//token/avatar/change' //上传接口
                , done: function (res) {
                    if (res.code === 0) {
                        $("#avatar").find("img").attr("src", res.data.src);
                        layer.msg(res.msg || res.message);
                    } else {
                        layer.msg(res.message)
                    }
                }
                , error: function () {
                    layer.msg("上传失败！");
                }
            });

            $("#nickname-change").click(function () {
                $.post("/ubs/token/nickname/change"
                    , {
                        nickname: $("#nickname").val()
                    }
                    , function (resp) {
                        layer.msg(resp.message);
                        if (resp.code === 200) {
                            setTimeout(function () {
                                location.reload();
                            }, 1000);
                        }
                    });
            });

            $("#sendMailCode").click(function () {
                var $sendCodeBtn = $("#sendCode");
                $sendCodeBtn.text("已发送");
                $("#sendSeconds").text("(60)");
                var $this = $("#sendMailCode");
                $this.addClass("send-code");
                $this.attr("disabled", true);
                var num = 60;
                var i = setInterval(function () {
                    num--;
                    var $second = $("#sendSeconds");
                    $second.text("(" + num + ")");
                    if (num === 0) {
                        clearInterval(i);
                        $sendCodeBtn.text("重新发送");
                        $second.text("");
                        $this.removeClass("send-code");
                        $this.attr("disabled", false);
                    }
                }, 1000);
                $.post("/sendMailCode", {}, function (resp) {
                    layer.msg(resp.message);
                })
            });

            $("#pass-change").click(function () {
                $.post("/ubs/token/password/change", {
                    pass: md5($("input[name=password]").val()),
                    code: $("input[name=mailCode]").val()
                }, function (resp) {
                    layer.msg(resp.message);
                })
            });

            var sign_temp = true;
            $("#sign").click(function () {
                if (sign_temp) {
                    $.ajax({
                        url: '/ubs/token/sign'
                        , data: {}
                        , type: "post"
                        , dataType: "json"
                        , beforeSend: function () {
                            sign_temp = false;
                        }
                        , success: function (resp) {
                            layer.msg(resp.message);
                            setTimeout(function () {
                                if (resp.code === 200) {
                                    location.reload();
                                }
                            }, 800);
                        }, complete: function () {
                            sign_temp = true;
                        }
                    })
                } else {
                    layer.msg("不要心急，请稍等一会...");
                }
            });

            $("#cash-recharge").click(function () {
                var html =
                    '<div class="layui-container layui-mt10" style="width: 100%;">' +
                    '<p class="layui-elem-quote">充值卡购买地址：<a href="' + [[${settings.cash_recharge_url}]] + '" target="_blank">点击前往购买</a></p>' +
                    '<p class="layui-mt20"><input class="layui-input" style="width: 100%;"placeholder="输入16位卡密（不包含短线），如：ABCD-EFGH-IJKL-MNOP"></p>' +
                    '<p class="layui-mt20 pull-right"><button type="button" class="layui-btn layui-btn-sm layui-btn-primary">确认充值</button></p>' +
                    '</div>';
                var rechargeIndex = layer.open({
                    type: 1,
                    title: '卡号充值',
                    area: ['450px', '280px'],
                    offset: '20%',
                    closeBtn: 1,
                    resize: false,
                    content: html
                });
            });

        });

    });
</script>
</body>
</html>